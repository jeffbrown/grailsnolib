<project name="grails" default="jar" basedir=".">

	<property file="build.properties"/>
	
	<path id="classpath">
		<fileset dir="${grails.lib}">
			<include name="*.jar"/>
		</fileset>
	</path>
	
	<target name="clean">
		<delete dir="${grails.build}"/>
		<delete dir="${grails.test.build}"/>
	</target>
			
	<target name="init" depends="clean">
		<mkdir dir="${grails.build}"/>
		<mkdir dir="${grails.test.build}"/>
		<mkdir dir="${grails.test.reports}"/>
		<mkdir dir="${grails.dist}"/>
	</target>
	
	<target name="build" depends="init">
		<javac debug="on" deprecation="on" destdir="${grails.build}" source="1.3" target="1.3">
			<src path="${grails.src.commons}"/>
			<src path="${grails.src.web}"/>
			<classpath refid="classpath"/>
		</javac>
	</target>
	
	<target name="build-test" depends="build">
		<javac debug="on" deprecation="on" destdir="${grails.test.build}" source="1.3" target="1.3" includes="**/*">			
			<src path="${grails.test.src.commons}"/>
			<src path="${grails.test.src.web}"/>
			<classpath refid="classpath"/>
			<classpath location="${grails.build}"/>
		</javac>
	</target>
	
	<target name="test" depends="build-test">
		<junit>
			<classpath refid="classpath"/>
			<classpath location="${grails.build}"/>
			<classpath location="${grails.test.build}"/>
			<classpath location="${grails.test.src.web}"/>
			<classpath location="${grails.test.src.commons}"/>
			
			<formatter type="plain" usefile="no"/>
			<formatter type="xml"/>
			<batchtest todir="${grails.test.reports}" fork="yes">
				<fileset dir="${grails.test.build}" includes="**/*Tests.class" excludes="**/Abstract*"/>
			</batchtest>
			
		</junit>
	</target>
	
	<target name="jar" depends="build-test">
		<delete file="${grails.dist}/${grails.dist.jar}"/>
		<jar destfile="${grails.dist}/${grails.dist.jar}" basedir="${grails.build}"/>
	</target>
	
	<target name="javadoc">
		<delete dir="${grails.javadoc}"/>
		<mkdir dir="${grails.javadoc}"/>
		
		<javadoc sourcepath="${grails.src.commons},${grails.src.web}" destdir="${grails.javadoc}" windowtitle="Grails ${grails.version}" source="1.3" access="package" author="true" version="true" use="true" defaultexcludes="true">
			<doctitle><![CDATA[<h1>Grails</h1>]]></doctitle>
			<bottom><![CDATA[<i>Copyright (c) 2005 The Grails project]]></bottom>
			<classpath refid="classpath"/>
			<packageset dir="${grails.src.commons}">
				<include name="org/codehaus/groovy/grails/**"/>
			</packageset>
			<packageset dir="${grails.src.web}">
				<include name="org/codehaus/groovy/grails/**"/>
			</packageset>
			<link href="http://java.sun.com/j2ee/1.4/docs/api"/>
			<link href="http://java.sun.com/j2se/1.4.2/docs/api"/>
						
		</javadoc>
	</target>
	
	<target name="dist" depends="javadoc">
		<antcall target="clean"/>
		<delete file="../grails-${grails.version}.tar.gz"/>
		<tar compression="gzip" destfile="../grails-${grails.version}.tar.gz" basedir="." excludes="**/CVS/**/*"/>
	</target>
	
</project>