#!/bin/sh

if [ -z "$JAVA_HOME" ] ; then
  echo "Error: JAVA_HOME is not defined"
  echo "Please set the JAVA_HOME environment variable and start Grails again"
  exit 1
fi

if [ -z "$GRAILS_HOME" ] ; then
  echo "Error: GRAILS_HOME is not defined"
  echo "Please define GRAIL_HOME and start Grails again"
  exit 1
fi

ANT_HOME=${GRAILS_HOME}/ant
GRAILS_ANT_CLASSPATH=$GRAILS_HOME/lib/bsf.jar
GRAILS_ANT_CLASSPATH=$GRAILS_ANT_CLASSPATH:$GRAILS_HOME/lib/groovy-all-1.0-jsr-05-SNAPSHOT.jar
GRAILS_ANT_CLASSPATH=$GRAILS_ANT_CLASSPATH:$GRAILS_HOME/lib/org.mortbay.jetty.jar
GRAILS_ANT_CLASSPATH=$GRAILS_ANT_CLASSPATH:$GRAILS_HOME/lib/commons-logging.jar
GRAILS_ANT_CLASSPATH=$GRAILS_ANT_CLASSPATH:$GRAILS_HOME/lib/commons-el.jar
GRAILS_ANT_CLASSPATH=$GRAILS_ANT_CLASSPATH:$GRAILS_HOME/lib/javax.servlet.jar
GRAILS_ANT_CLASSPATH=$GRAILS_ANT_CLASSPATH:$GRAILS_HOME/lib/log4j-1.2.8.jar
GRAILS_ANT_CLASSPATH=$GRAILS_ANT_CLASSPATH:$GRAILS_HOME/lib/jasper-compiler.jar
GRAILS_ANT_CLASSPATH=$GRAILS_ANT_CLASSPATH:$GRAILS_HOME/lib/jasper-runtime.jar
GRAILS_ANT_CLASSPATH=$GRAILS_ANT_CLASSPATH:$GRAILS_HOME/lib/xml-apis.jar
GRAILS_ANT_CLASSPATH=$GRAILS_ANT_CLASSPATH:$GRAILS_HOME/lib/xercesImpl.jar
GRAILS_BUILD_FILE=${GRAILS_HOME}/src/grails/build.xml
ANT_BIN=${ANT_HOME}/bin/ant
BASEDIR=`pwd`

case "`uname`" in
  CYGWIN*)
    GRAILS_BUILD_FILE=`cygpath --windows "$GRAILS_BUILD_FILE"`;
    GRAILS_ANT_CLASSPATH=`cygpath --windows -p "$GRAILS_ANT_CLASSPATH"`
    BASEDIR=`cygpath --windows "$BASEDIR"`
    ;;
esac

${ANT_BIN} -lib "${GRAILS_ANT_CLASSPATH}" -f ${GRAILS_BUILD_FILE} -Dbasedir=${BASEDIR} $@
