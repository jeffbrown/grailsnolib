<project name="grails-bundle">

	<target name="jar" depends="build-test" description="Build the entire source, run all tests and create the Grails JAR file.">
		<delete>
			<fileset dir="${grails.dist}" includes="*"/>
		</delete>
        <jar destfile="${grails.dist}/grails-spring-${grails.version}.jar" manifest="${grails.build}/META-INF/MANIFEST.MF">
            <fileset dir="${grails.build}">
                  <include name="META-INF/**" />
                  <include name="grails/spring/**" />
                  <include name="**/groovy/grails/commons/spring/**" />
              </fileset>            
        </jar>
        <jar destfile="${grails.dist}/grails-core-${grails.version}.jar" manifest="${grails.build}/META-INF/MANIFEST.MF">
              <fileset dir="${grails.build}">
                  <include name="META-INF/**" />
                  <include name="grails/ui/**" />
                  <include name="grails/util/**" />
                  <include name="**/groovy/grails/beans/factory/**" />
                  <include name="**/groovy/grails/cli/**" />
                  <include name="**/groovy/grails/commons/**" />
                  <include name="**/groovy/grails/compiler/**" />
                  <include name="**/groovy/grails/orm/support/**" />
                  <include name="**/groovy/grails/exceptions/**" />
                  <include name="**/groovy/grails/support/**" />
                  <include name="**/groovy/grails/validation/**" />
                  <include name="**/groovy/grails/plugins/**" />
                  <exclude name="**/groovy/grails/commons/spring/**" />
                  <exclude name="**/groovy/grails/plugins/orm/hibernate**" />
                  <exclude name="**/groovy/grails/plugins/web/**" />
                  <exclude name="**/groovy/grails/plugins/converters/**" />
                  <exclude name="**/groovy/grails/plugins/webflow/**" />
                  <exclude name="**/groovy/grails/plugins/scafolding/**" />
                  <exclude name="**/groovy/grails/validation/Hibernate**" />
              </fileset>
        </jar>
        <jar destfile="${grails.dist}/grails-gorm-${grails.version}.jar" manifest="${grails.build}/META-INF/MANIFEST.MF">
              <fileset dir="${grails.build}">
                  <include name="META-INF/**" />	
                  <include name="grails/orm/**" />
                  <include name="**/groovy/grails/orm/hibernate/**" />
                  <include name="**/groovy/grails/plugins/orm/hibernate/**" />
                  <include name="**/groovy/grails/validation/Hibernate**" />
              </fileset>
        </jar>
        <jar destfile="${grails.dist}/grails-web-${grails.version}.jar" manifest="${grails.build}/META-INF/MANIFEST.MF">
             <fileset dir="${grails.build}">
                  <include name="META-INF/**" />	
                  <include name="grails/converters/**" />
                  <include name="grails/util/**" />
                  <exclude name="grails/util/Generate**" />
                  <include name="**/groovy/grails/web/**" />
                 <include name="**/groovy/grails/plugins/web/**" />
                 <include name="**/groovy/grails/plugins/converters/**" />

                  <include name="**/groovy/grails/webflow/**" />
              </fileset>               
        </jar>
        <jar destfile="${grails.dist}/grails-webflow-${grails.version}.jar" manifest="${grails.build}/META-INF/MANIFEST.MF">
             <fileset dir="${grails.build}">
                  <include name="META-INF/**" />	
                  <include name="**/groovy/grails/webflow/**" />
                 <include name="**/groovy/grails/plugins/webflow/**" />
              </fileset>
        </jar>
        <jar destfile="${grails.dist}/grails-crud-${grails.version}.jar" manifest="${grails.build}/META-INF/MANIFEST.MF">
            <fileset dir="${grails.build}">
                 <include name="META-INF/**" />	
                 <include name="grails/util/Generate**" />
                 <include name="**/groovy/grails/scaffolding/**" />
                <include name="**/groovy/grails/plugins/scafolding/**" />
             </fileset>

        </jar>
    </target>

    <target name="package" depends="clean,test,jar,javadoc" description="Create the release archives for Grails.">
    	<delete>
		  <fileset dir="${grails.dist}">
		  		<include name="*.zip"/>
     	  		<include name="*.tar.gz"/>
		  </fileset>
		</delete>
        <delete  file="${grails.dist}/${archive}.zip" failonerror="true"/>
        <delete file="${grails.dist}/${archive}.tar.gz" failonerror="true"/>
        <delete dir="tmp" failonerror="true"/>
        <antcall target="create-binary-release"/>
        <antcall target="create-source-release"/>
    </target>

</project>