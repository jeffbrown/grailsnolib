<project name="grails-compile">

    <taskdef name="groovyc"  classname="org.codehaus.groovy.ant.Groovyc" classpathref="classpath" />

    <target name="build-init">
		<mkdir dir="${grails.build}"/>
		<mkdir dir="${grails.build}"/>
		<mkdir dir="${grails.test.build}"/>
		<mkdir dir="${grails.test.reports}"/>
		<mkdir dir="${grails.dist}"/>
	</target>

	<target name="build" depends="build-init" description="compile Java and Groovy sources" >
		<javac debug="on" deprecation="on" destdir="${grails.build}" source="1.3" target="1.3">
			<src path="${grails.src.commons}"/>
			<src path="${grails.src.web}"/>
			<src path="${grails.src.persistence}"/>
			<src path="${grails.src.scaffolding}"/>
			<classpath refid="classpath"/>
		</javac>
        <groovyc destdir="${grails.build}" >
			<src path="${grails.src.commons}"/>
		    <classpath>
		      <pathelement path="${grails.build}"/>
		    </classpath>  
			<classpath refid="classpath"/>    
		</groovyc>
		<copy todir="${grails.build}">
			<fileset dir="${grails.src.commons}" excludes="**/*.java" />
			<fileset dir="${grails.src.web}" excludes="**/*.java" />
			<fileset dir="${grails.src.persistence}" excludes="**/*.java"/>
			<fileset dir="${grails.src.scaffolding}" excludes="**/*.java"/>
		</copy>
        <antcall target="build:java5" />
    </target>

    <target name="build:checkj5">
        <condition property="is.java.5">
              <equals arg1="${ant.java.version}" arg2="1.5"/>
        </condition>
    </target>

    <target name="build:java5" depends="build:checkj5" if="is.java.5">
        <!--build java 5 sources-->
        <javac srcdir="${grails.src.tiger}" destdir="${grails.build}" classpathref="classpath" debug="on" deprecation="on" optimize="off"/>
    </target>

</project>